---
export interface Props {
  password: string;
  errorMessage?: string;
}

const { password, errorMessage = "Non sei autorizzato a vedere questa pagina" } = Astro.props;
---

<div id="password-container" data-password={password} data-error-message={errorMessage}>
  <div id="protected-content" style="display: none;">
    <slot />
  </div>

  <div id="unauthorized-message" class="unauthorized-message">
    <h2>{errorMessage}</h2>
    <p>È richiesta una password valida per accedere a questo contenuto.</p>
  </div>
</div>

<script>
  function checkPassword() {
    const container = document.getElementById('password-container');
    const protectedContent = document.getElementById('protected-content');
    const unauthorizedMessage = document.getElementById('unauthorized-message');

    if (!container || !protectedContent || !unauthorizedMessage) return;

    const requiredPassword = container.getAttribute('data-password');
    const urlParams = new URLSearchParams(window.location.search);
    const providedPassword = urlParams.get('password');

    if (providedPassword === requiredPassword) {
      // Password corretta - mostra il contenuto
      protectedContent.style.display = 'block';
      unauthorizedMessage.style.display = 'none';
    } else {
      // Password sbagliata o mancante - mostra il messaggio di errore
      protectedContent.style.display = 'none';
      unauthorizedMessage.style.display = 'block';
    }
  }

  // Esegui il controllo quando la pagina è caricata
  document.addEventListener('DOMContentLoaded', checkPassword);

  // Esegui il controllo anche se l'URL cambia (per SPA)
  window.addEventListener('popstate', checkPassword);
</script>

<style>
  .unauthorized-message {
    background: var(--sl-color-red-low);
    border: 2px solid var(--sl-color-red);
    border-radius: 8px;
    padding: 2rem;
    margin: 2rem 0;
    text-align: center;
    color: var(--sl-color-red-high);
  }

  .unauthorized-message h2 {
    margin-top: 0;
    color: var(--sl-color-red);
  }

  .unauthorized-message p {
    margin-bottom: 0;
    opacity: 0.8;
  }
</style>
